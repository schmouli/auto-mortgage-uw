# Client Intake & Application
Model: kimi-k2-thinking:cloud (complexity: reasoning)
Project: OnLendHub - Canadian Mortgage Underwriting

# OnLendHub: Client Intake & Application Module Architecture

## 1. Enhanced Database Schema Design

### 1.1 SQLAlchemy Models with Encryption

```python
# app/db/base.py
from sqlalchemy import Column, Integer, String, DateTime, ForeignKey, Numeric, Enum, Date
from sqlalchemy.orm import relationship, declarative_base
from sqlalchemy.sql import func
from app.core.security import EncryptedType
from enum import Enum as PyEnum

Base = declarative_base()

class EmploymentStatus(PyEnum):
    EMPLOYED = "employed"
    SELF_EMPLOYED = "self_employed"
    UNEMPLOYED = "unemployed"
    RETIRED = "retired"

class ApplicationStatus(PyEnum):
    DRAFT = "draft"
    SUBMITTED = "submitted"
    UNDERWRITING_REVIEW = "underwriting_review"
    APPROVED = "approved"
    DECLINED = "declined"
    NEEDS_INFO = "needs_info"
    CLOSED = "closed"

class ApplicationType(PyEnum):
    PURCHASE = "purchase"
    REFINANCE = "refinance"
    RENEWAL = "renewal"
    EQUITY_TAKEOUT = "equity_takeout"

class MortgageType(PyEnum):
    FIXED = "fixed"
    VARIABLE = "variable"
    ADJUSTABLE = "adjustable"
    HYBRID = "hybrid"

class MaritalStatus(PyEnum):
    SINGLE = "single"
    MARRIED = "married"
    COMMON_LAW = "common_law"
    DIVORCED = "divorced"
    WIDOWED = "widowed"

# Audit mixin for all tables
class AuditMixin:
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())
    created_by = Column(Integer, ForeignKey("users.id"))
    updated_by = Column(Integer, ForeignKey("users.id"))

class Client(Base, AuditMixin):
    __tablename__ = "clients"
    
    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(Integer, ForeignKey("users.id"), unique=True, nullable=False, index=True)
    
    # Encrypted sensitive fields
    sin_encrypted = Column(EncryptedType, nullable=False, unique=True, index=True)
    date_of_birth_encrypted = Column(EncryptedType, nullable=False)
    
    # Public fields
    employment_status = Column(Enum(EmploymentStatus), nullable=False, index=True)
    employer_name = Column(String(255))
    years_employed = Column(Numeric(4, 2))  # Allows 1.5 years
    annual_income = Column(Numeric(12, 2), nullable=False)  # 999,999,999.99 max
    other_income = Column(Numeric(12, 2), default=0)
    credit_score = Column(Integer)  # 300-900
    marital_status = Column(Enum(MaritalStatus))
    
    # Relationships
    user = relationship("User", back_populates="client", foreign_keys="[Client.user_id]")
    applications = relationship("Application", back_populates="client")
    
    __table_args__ = (
        # Index for common queries
        Index('idx_client_income', 'annual_income'),
        # Row Level Security policy
        {"postgresql_partition_by": "RANGE (created_at)"}  # For large volume
    )

class Application(Base, AuditMixin):
    __tablename__ = "applications"
    
    id = Column(Integer, primary_key=True, index=True)
    client_id = Column(Integer, ForeignKey("clients.id"), nullable=False, index=True)
    broker_id = Column(Integer, ForeignKey("brokers.id"), nullable=False, index=True)
    
    # Application details
    application_type = Column(Enum(ApplicationType), nullable=False, index=True)
    status = Column(Enum(ApplicationStatus), default=ApplicationStatus.DRAFT, index=True)
    
    # Property details
    property_address = Column(String(500), nullable=False)
    property_type = Column(String(100), nullable=False)
    property_value = Column(Numeric(12, 2), nullable=False)
    purchase_price = Column(Numeric(12, 2), nullable=False)
    
    # Financial terms
    down_payment = Column(Numeric(12, 2), nullable=False)
    requested_loan_amount = Column(Numeric(12, 2), nullable=False)
    amortization_years = Column(Integer, nullable=False)  # 5-30
    term_years = Column(Integer, nullable=False)  # 1-10
    mortgage_type = Column(Enum(MortgageType), nullable=False)
    
    # Timestamps
    submitted_at = Column(DateTime(timezone=True))
    
    # Relationships
    client = relationship("Client", back_populates="applications")
    broker = relationship("Broker", back_populates="applications")
    co_borrowers = relationship("CoBorrower", back_populates="application", cascade="all, delete-orphan")
    
    __table_args__ = (
        # Check constraints for validation rules
        CheckConstraint('purchase_price > 0', name='check_purchase_price_positive'),
        CheckConstraint('annual_income > 0', name='check_annual_income_positive'),
        CheckConstraint('amortization_years >= 5 AND amortization_years <= 30', name='check_amortization_range'),
        CheckConstraint('term_years >= 1 AND term_years <= 10', name='check_term_range'),
        # Composite index for broker queries
        Index('idx_application_broker_status', 'broker_id', 'status'),
    )

class CoBorrower(Base, AuditMixin):
    __tablename__ = "co_borrowers"
    
    id = Column(Integer, primary_key=True, index=True)
    application_id = Column(Integer, ForeignKey("applications.id"), nullable=False, index=True)
    
    # Public fields only - SIN encrypted
    full_name = Column(String(255), nullable=False)
    sin_encrypted = Column(EncryptedType, nullable=False)
    annual_income = Column(Numeric(12, 2), nullable=False)
    employment_status = Column(Enum(EmploymentStatus), nullable=False)
    credit_score = Column(Integer)
    
    # Relationship
    application = relationship("Application", back_populates="co_borrowers")
    
    __table_args__ = (
        Index('idx_coborrower_application', 'application_id'),
    )

# Audit log table for compliance
class AuditLog(Base):
    __tablename__ = "audit_logs"
    
    id = Column(Integer, primary_key=True)
    table_name = Column(String(100), nullable=False, index=True)
    record_id = Column(Integer, nullable=False, index=True)
    action = Column(String(50), nullable=False)  # INSERT, UPDATE, DELETE
    old_values = Column(JSON)  # Excludes sensitive fields
    new_values = Column(JSON)  # Excludes sensitive fields
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False, index=True)
    timestamp = Column(DateTime(timezone=True), server_default=func.now())
    ip_address = Column(INET)
```

### 1.2 PostgreSQL RLS Policies

```sql
-- Enable RLS
ALTER TABLE applications ENABLE ROW LEVEL SECURITY;
ALTER TABLE clients ENABLE ROW LEVEL SECURITY;
ALTER TABLE co_borrowers ENABLE ROW LEVEL SECURITY;

-- Client can only view own applications
CREATE POLICY client_view_own_applications ON applications
    FOR SELECT
    USING (
        client_id IN (
            SELECT id FROM clients WHERE user_id = current_setting('app.current_user_id')::int
        )
    );

-- Broker can only view assigned applications
CREATE POLICY broker_view_assigned_applications ON applications
    FOR ALL
    USING (
        broker_id = current_setting('app.current_broker_id')::int
    );
```

## 2. Application Status Workflow Engine

### 2.1 State Machine Definition

```python
# app/core/workflow.py
from enum import Enum
from typing import Dict, Set, Callable

class WorkflowTransitionError(Exception):
    pass

class ApplicationWorkflow:
    """State machine for application lifecycle"""
    
    ALLOWED_TRANSITIONS: Dict[ApplicationStatus, Set[ApplicationStatus]] = {
        ApplicationStatus.DRAFT: {
            ApplicationStatus.SUBMITTED,
            ApplicationStatus.CLOSED
        },
        ApplicationStatus.SUBMITTED: {
            ApplicationStatus.UNDERWRITING_REVIEW,
            ApplicationStatus.NEEDS_INFO
        },
        ApplicationStatus.UNDERWRITING_REVIEW: {
            ApplicationStatus.APPROVED,
            ApplicationStatus.DECLINED,
            ApplicationStatus.NEEDS_INFO
        },
        ApplicationStatus.NEEDS_INFO: {
            ApplicationStatus.SUBMITTED,
            ApplicationStatus.CLOSED
        },
        ApplicationStatus.APPROVED: {
            ApplicationStatus.CLOSED
        },
        ApplicationStatus.DECLINED: {
            ApplicationStatus.CLOSED
        },
        ApplicationStatus.CLOSED: set()  # Terminal state
    }
    
    # Who can perform transitions
    TRANSITION_PERMISSIONS: Dict[tuple, list] = {
        (ApplicationStatus.DRAFT, ApplicationStatus.SUBMITTED): ["client", "broker"],
        (ApplicationStatus.SUBMITTED, ApplicationStatus.UNDERWRITING_REVIEW): ["system"],
        (ApplicationStatus.UNDERWRITING_REVIEW, ApplicationStatus.APPROVED): ["underwriter"],
        # ... etc
    }
    
    @classmethod
    def transition(
        cls, 
        current_status: ApplicationStatus, 
        new_status: ApplicationStatus,
        user_role: str
    ) -> bool:
        if new_status not in cls.ALLOWED_TRANSITIONS.get(current_status, set()):
            raise WorkflowTransitionError(
                f"Invalid transition from {current_status} to {new_status}"
            )
        
        # Check permissions
        required_roles = cls.TRANSITION_PERMISSIONS.get(
            (current_status, new_status), 
            []
        )
        if user_role not in required_roles:
            raise WorkflowTransitionError(
                f"Role {user_role} cannot perform this transition"
            )
        
        return True
```

### 2.2 Workflow Service

```python
# app/services/workflow_service.py
from app.core.workflow import ApplicationWorkflow, WorkflowTransitionError

class ApplicationWorkflowService:
    def __init__(self, db: Session, current_user: User):
        self.db = db
        self.current_user = current_user
    
    async def transition_application(
        self, 
        application_id: int, 
        new_status: ApplicationStatus
    ) -> Application:
        application = await self.db.get(Application, application_id)
        
        if not application:
            raise HTTPException(404, "Application not found")
        
        # Check access control
        await self._check_access(application)
        
        # Validate transition
        ApplicationWorkflow.transition(
            application.status,
            new_status,
            self.current_user.role
        )
        
        # Store old status for audit
        old_status = application.status
        application.status = new_status
        
        if new_status == ApplicationStatus.SUBMITTED:
            application.submitted_at = datetime.utcnow()
        
        # Create audit entry
        await self._create_audit_log(
            "applications",
            application.id,
            "UPDATE",
            {"status": old_status},
            {"status": new_status}
        )
        
        await self.db.commit()
        return application
```

## 3. API Implementation

### 3.1 Pydantic Schemas (Security-First)

```python
# app/schemas/application.py
from pydantic import BaseModel, Field, validator, ConfigDict
from decimal import Decimal
from typing import List, Optional
from datetime import datetime

# Never include encrypted fields in API responses
class ClientResponse(BaseModel):
    id: int
    employment_status: str
    employer_name: Optional[str]
    years_employed: Optional[Decimal]
    annual_income: Decimal
    other_income: Decimal
    credit_score: Optional[int]
    marital_status: Optional[str]
    
    model_config = ConfigDict(from_attributes=True)

class CoBorrowerCreate(BaseModel):
    full_name: str = Field(..., max_length=255)
    sin: str = Field(..., pattern=r'^\d{9}$')  # Validates format, encrypted before storage
    annual_income: Decimal = Field(..., gt=0)
    employment_status: str
    credit_score: Optional[int] = Field(None, ge=300, le=900)

class CoBorrowerResponse(BaseModel):
    id: int
    full_name: str
    annual_income: Decimal
    employment_status: str
    credit_score: Optional[int]
    
    # SIN never exposed in API
    model_config = ConfigDict(from_attributes=True)

class ApplicationCreate(BaseModel):
    application_type: str
    property_address: str = Field(..., max_length=500)
    property_type: str = Field(..., max_length=100)
    property_value: Decimal = Field(..., gt=0)
    purchase_price: Decimal = Field(..., gt=0)
    down_payment: Decimal = Field(..., ge=0)
    amortization_years: int
    term_years: int
    mortgage_type: str
    
    co_borrowers: List[CoBorrowerCreate] = []
    
    @validator('amortization_years')
    def validate_amortization(cls, v, values):
        # Dynamic validation based on insured status
        purchase = values.get('purchase_price', 0)
        down = values.get('down_payment', 0)
        ltv = (purchase - down) / purchase if purchase > 0 else 0
        
        max_years = 30 if ltv > 0.8 else 25  # CMHC rule
        if not (5 <= v <= max_years):
            raise ValueError(f'Amortization must be 5-{max_years} years')
        return v
    
    @validator('term_years')
    def validate_term(cls, v):
        if not (1 <= v <= 10):
            raise ValueError('Term must be 1-10 years')
        return v

class ApplicationResponse(BaseModel):
    id: int
    client_id: int
    broker_id: int
    status: str
    application_type: str
    property_address: str
    property_value: Decimal
    purchase_price: Decimal
    down_payment: Decimal
    requested_loan_amount: Decimal
    amortization_years: int
    term_years: int
    mortgage_type: str
    submitted_at: Optional[datetime]
    created_at: datetime
    updated_at: Optional[datetime]
    
    client: ClientResponse
    co_borrowers: List[CoBorrowerResponse]
    
    model_config = ConfigDict(from_attributes=True)

class ApplicationSummaryPDF(BaseModel):
    """PDF-ready sanitized data (no PII)"""
    application_id: int
    status: str
    property_address: str
    property_value: Decimal
    purchase_price: Decimal
    loan_amount: Decimal
    ltv_ratio: Decimal
    debt_to_income_ratio: Decimal
    # ... calculated fields only
```

### 3.2 FastAPI Router

```python
# app/api/v1/routers/applications.py
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.ext.asyncio import AsyncSession
from app.core.security import get_current_user, encrypt_sin, verify_broker_access
from app.core.workflow import ApplicationStatus
from app.services.application_service import ApplicationService

router = APIRouter(prefix="/applications", tags=["applications"])

@router.post(
    "/", 
    response_model=ApplicationResponse, 
    status_code=status.HTTP_201_CREATED
)
async def create_application(
    app_data: ApplicationCreate,
    db: AsyncSession = Depends(get_db),
    current_user: User = Depends(get_current_user)
):
    """Create a new mortgage application"""
    service = ApplicationService(db, current_user)
    
    # Encrypt SINs before storage
    for co_borrower in app_data.co_borrowers:
        co_borrower.sin = encrypt_sin(co_borrower.sin)
    
    application = await service.create_application(app_data)
    return application

@router.get("/", response_model=List[ApplicationResponse])
async def list_applications(
    status_filter: Optional[ApplicationStatus] = None,
    skip: int = 0,
    limit: int = 50,
    db: AsyncSession = Depends(get_db),
    current_user: User = Depends(get_current_user)
):
    """List applications with access control"""
    service = ApplicationService(db, current_user)
    applications = await service.get_user_applications(
        status_filter=status_filter,
        skip=skip,
        limit=limit
    )
    return applications

@router.get("/{application_id}", response_model=ApplicationResponse)
async def get_application(
    application_id: int,
    db: AsyncSession = Depends(get_db),
    current_user: User = Depends(get_current_user)
):
    """Get single application - never returns SIN/DOB"""
    service = ApplicationService(db, current_user)
    application = await service.get_application(application_id)
    
    if not application:
        raise HTTPException(404, "Application not found")
    
    # RLS handles filtering, but double-check
    await service.verify_access(application)
    
    return application

@router.put("/{application_id}", response_model=ApplicationResponse)
async def update_application(
    application_id: int,
    update_data: ApplicationUpdate,
    db: AsyncSession = Depends(get_db),
    current_user: User = Depends(get_current_user)
):
    """Update draft applications only"""
    service = ApplicationService(db, current_user)
    application = await service.update_application(application_id, update_data)
    return application

@router.post("/{application_id}/submit", response_model=ApplicationResponse)
async def submit_application(
    application_id: int,
    db: AsyncSession = Depends(get_db),
    current_user: User = Depends(get_current_user)
):
    """Submit application for underwriting"""
    workflow_service = ApplicationWorkflowService(db, current_user)
    application = await workflow_service.transition_application(
        application_id,
        ApplicationStatus.SUBMITTED
    )
    
    # Trigger underwriting queue
    await queue_underwriting_task(application_id)
    
    return application

@router.get("/{application_id}/summary", response_model=ApplicationSummaryPDF)
async def get_application_summary(
    application_id: int,
    db: AsyncSession = Depends(get_db),
    current_user: User = Depends(get_current_user)
):
    """Get PDF-ready summary (no PII)"""
    service = ApplicationService(db, current_user)
    summary = await service.get_pdf_summary(application_id)
    return summary
```

## 4. Security & Encryption Implementation

### 4.1 AES-256 Encryption Service

```python
# app/core/security/encryption.py
from Crypto.Cipher import AES
from Crypto.Random import get_random_bytes
from Crypto.Protocol.KDF import PBKDF2
import base64
import os

class EncryptionService:
    """AES-256-GCM encryption for PII"""
    
    def __init__(self):
        # Key from KMS (never hardcoded)
        self.key = self._get_key_from_kms()
        self.key_size = 32  # AES-256
    
    def _get_key_from_kms(self) -> bytes:
        """Retrieve encryption key from key management system"""
        # AWS KMS implementation
        if os.getenv("KMS_PROVIDER") == "aws":
            return self._get_aws_kms_key()
        # HashiCorp Vault implementation
        elif os.getenv("KMS_PROVIDER") == "vault":
            return self._get_vault_key()
        # Development fallback (NEVER in production)
        return os.getenv("DEVELOPMENT_ENCRYPTION_KEY", "").encode()
    
    def encrypt(self, plaintext: str) -> str:
        """Encrypt with AES-256-GCM"""
        if not plaintext:
            return ""
        
        # Generate random nonce
        nonce = get_random_bytes(12)  # GCM recommended nonce size
        
        # Create cipher
        cipher = AES.new(self.key, AES.MODE_GCM, nonce=nonce)
        
        # Encrypt
        ciphertext, tag = cipher.encrypt_and_digest(plaintext.encode())
        
        # Pack nonce + tag + ciphertext
        encrypted_data = nonce + tag + ciphertext
        
        # Base64 encode for storage
        return base64.b64encode(encrypted_data).decode()
    
    def decrypt(self, encrypted: str) -> str:
        """Decrypt AES-256-GCM"""
        if not encrypted:
            return ""
        
        # Decode from base64
        encrypted_data = base64.b64decode(encrypted.encode())
        
        # Extract components
        nonce = encrypted_data[:12]
        tag = encrypted_data[12:28]
        ciphertext = encrypted_data[28:]
        
        # Decrypt
        cipher = AES.new(self.key, AES.MODE_GCM, nonce=nonce)
        plaintext = cipher.decrypt_and_verify(ciphertext, tag)
        
        return plaintext.decode()

# Global instance
encryption_service = EncryptionService()

# SQLAlchemy custom type
class EncryptedType(TypeDecorator):
    impl = String
    
    def process_bind_param(self, value, dialect):
        if value is None:
            return None
        return encryption_service.encrypt(value)
    
    def process_result_value(self, value, dialect):
        if value is None:
            return None
        return encryption_service.decrypt(value)
```

### 4.2 Key Management Strategy

```yaml
# Key Management Architecture
kms_strategy:
  primary: "AWS KMS"
  backup: "HashiCorp Vault"
  key_rotation:
    frequency: "90_days"
    automatic: true
    last_rotation: "2024-01-15"
  
  key_hierarchy:
    - master_key: "KMS-managed"
      data_keys:
        - sin_encryption_key
        - dob_encryption_key
        - financial_data_key
    
  access_control:
    decrypt_permissions:
      - "application_server_role"
      - "audit_service_role"
    encrypt_permissions:
      - "application_server_role"
    
  logging:
    cloudtrail: "enabled"
    key_usage: "logged"
    alert_on_anomalous_access: true
```

## 5. Co-Borrower Management

### 5.1 Dedicated Endpoints

```python
# app/api/v1/routers/co_borrowers.py
@router.post("/applications/{application_id}/co-borrowers")
async def add_co_borrower(
    application_id: int,
    co_borrower: CoBorrowerCreate,
    db: AsyncSession = Depends(get_db),
    current_user: User = Depends(get_current_user)
):
    """Add co-borrower to application (draft only)"""
    service = CoBorrowerService(db, current_user)
    
    # Encrypt SIN before storage
    co_borrower.sin = encrypt_sin(co_borrower.sin)
    
    coborrower = await service.add_co_borrower(application_id, co_borrower)
    return coborrower

@router.delete("/applications/{application_id}/co-borrowers/{coborrower_id}")
async def remove_co_borrower(
    application_id: int,
    coborrower_id: int,
    db: AsyncSession = Depends(get_db),
    current_user: User = Depends(get_current_user)
):
    """Remove co-borrower (draft only)"""
    service = CoBorrowerService(db, current_user)
    await service.remove_co_borrower(application_id, coborrower_id)
    return {"status": "deleted"}
```

## 6. Audit & Compliance Layer

### 6.1 Audit Logger

```python
# app/core/audit.py
import json
import logging

class AuditLogger:
    """Compliant audit logging - excludes PII"""
    
    SENSITIVE_FIELDS = {
        'sin_encrypted', 'date_of_birth_encrypted', 
        'annual_income', 'other_income', 'credit_score'
    }
    
    @staticmethod
    def log_action(
        table_name: str,
        record_id: int,
        action: str,
        old_values: dict,
        new_values: dict,
        user_id: int,
        ip_address: str
    ):
        # Strip sensitive fields
        safe_old = {
            k: v for k, v in old_values.items() 
            if k not in AuditLogger.SENSITIVE_FIELDS
        }
        safe_new = {
            k: v for k, v in new_values.items() 
            if k not in AuditLogger.SENSITIVE_FIELDS
        }
        
        audit_entry = {
            "table": table_name,
            "record_id": record_id,
            "action": action,
            "user_id": user_id,
            "timestamp": datetime.utcnow().isoformat(),
            "ip": ip_address,
            "changes": {
                "old": safe_old,
                "new": safe_new
            }
        }
        
        # Write to separate audit database
        logger = logging.getLogger("audit")
        logger.info(json.dumps(audit_entry))
        
        # Also store in PostgreSQL for querying
        return AuditLog(
            table_name=table_name,
            record_id=record_id,
            action=action,
            old_values=safe_old,
            new_values=safe_new,
            user_id=user_id,
            ip_address=ip_address
        )
```

## 7. Infrastructure & Deployment

### 7.1 Docker Configuration

```dockerfile
# Dockerfile
FROM python:3.11.8-slim

WORKDIR /app

# Install PostgreSQL client and security libs
RUN apt-get update && apt-get install -y \
    libpq-dev \
    gcc \
    python3-dev \
    libssl-dev \
    && rm -rf /var/lib/apt/lists/*

# Install Python dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy application
COPY . .

# Non-root user
RUN useradd -m -u 1000 appuser
USER appuser

EXPOSE 8000

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### 7.2 Environment Variables

```bash
# .env.production
DATABASE_URL="postgresql+asyncpg://user:pass@host:5432/onlendhub"
KMS_PROVIDER="aws"
AWS_KMS_KEY_ID="arn:aws:kms:ca-central-1:123456789012:key/abcd-1234"
VAULT_ADDR="https://vault.onlendhub.internal:8200"
ENCRYPTION_KEY_ROTATION_DAYS=90

# JWT Configuration
JWT_SECRET="vault://secret/data/jwt#secret"
JWT_ALGORITHM="RS256"
JWT_EXPIRE_MINUTES=60

# Audit Logging
AUDIT_LOG_LEVEL="INFO"
AUDIT_LOG_DESTINATION="postgresql://audit:user@audit-db:5432/audit_logs"
```

## 8. Testing Strategy

```python
# tests/test_application_workflow.py
import pytest
from unittest.mock import Mock

def test_amortization_validation_insured():
    """Test CMHC 30-year max for high LTV"""
    data = ApplicationCreate(
        purchase_price=Decimal("500000"),
        down_payment=Decimal("50000"),  # 90% LTV
        amortization_years=30,
        term_years=5,
        # ... other required fields
    )
    assert data.amortization_years == 30

def test_amortization_validation_uninsured():
    """Test 25-year max for uninsured"""
    data = ApplicationCreate(
        purchase_price=Decimal("500000"),
        down_payment=Decimal("125000"),  # 75% LTV
        amortization_years=30,  # Should fail
        term_years=5,
        # ... other required fields
    )
    with pytest.raises(ValueError):
        # Trigger validation
        ApplicationCreate.validate(data)

def test_sin_encryption():
    """Verify SIN never appears in logs or responses"""
    sin = "123456789"
    encrypted = encrypt_sin(sin)
    
    assert encrypted != sin
    assert len(encrypted) > 50  # Encrypted data is longer
    assert not any(c.isdigit() for c in encrypted)  # No plain digits
```

## 9. Missing Details Resolution

### 9.1 Default Types & Values

```python
# app/core/defaults.py
DEFAULT_APPLICATION_TYPE = ApplicationType.PURCHASE
DEFAULT_MORTGAGE_TYPE = MortgageType.FIXED
DEFAULT_AMORTIZATION = 25
DEFAULT_TERM = 5

# Pre-defined property types for consistency
PROPERTY_TYPES = [
    "single_family_detached",
    "semi_detached",
    "townhouse",
    "condo_apartment",
    "condo_townhouse",
    "duplex",
    "triplex",
    "fourplex",
    "mobile_home"
]
```

### 9.2 Application Status Transitions

```mermaid
stateDiagram-v2
    [*] --> DRAFT: Client creates
    DRAFT --> SUBMITTED: Client/Broker submits
    DRAFT --> CLOSED: Client cancels
    SUBMITTED --> UNDERWRITING_REVIEW: System auto-advance
    SUBMITTED --> NEEDS_INFO: Underwriter requests
    UNDERWRITING_REVIEW --> APPROVED: Underwriter approves
    UNDERWRITING_REVIEW --> DECLINED: Underwriter declines
    UNDERWRITING_REVIEW --> NEEDS_INFO: Info missing
    NEEDS_INFO --> SUBMITTED: Client resubmits
    NEEDS_INFO --> CLOSED: Timeout (30 days)
    APPROVED --> CLOSED: Funded/Expired
    DECLINED --> CLOSED: Final
    CLOSED --> [*]: Archive
```

---

**Stack Justification**: This architecture leverages FastAPI's async capabilities for high-throughput mortgage processing, SQLAlchemy 2.0's type safety, and PostgreSQL's RLS for multi-tenant security. The encryption service ensures PII compliance (PIPEDA) while the workflow engine provides audit trails required by Canadian financial regulators.