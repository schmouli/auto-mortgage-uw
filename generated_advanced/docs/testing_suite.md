# Testing Suite
Model: kimi-k2-thinking:cloud (complexity: reasoning)
Project: Canadian Mortgage Underwriting

# Testing Suite Architecture: Canadian Mortgage Underwriting System

## 1. Testing Strategy & Philosophy

### Core Principles
- **Financial Accuracy First**: All calculation tests use `Decimal` types with explicit precision enforcement; floating-point operations trigger test failures
- **Compliance as Code**: FINTRAC and CMHC rules are codified as executable test specifications
- **Isolation & Reproducibility**: Every test runs in a transaction-isolated database context with deterministic fixtures
- **Shift-Left Security**: mTLS, JWT validation, and access control tests run on every PR, not just in staging

### Coverage Enforcement
- **Gate**: 80% overall, 100% on `underwriting/calculations.py`, `fintrac/detector.py`, `auth/jwt_handler.py`
- **Exclusions**: Generated OpenAPI clients, migration scripts
- **Metric**: Branch coverage required (not just line coverage)

---

## 2. Test Architecture Layers

```
tests/
├── unit/                      # <100ms per test, no I/O
├── integration/               # Real DB, mocked external services
├── e2e/                       # Full docker-compose stack
├── performance/               # Locust/k6 scenarios
├── security/                  # mTLS, penetration, OWASP
└── fixtures/                  # Reusable test data factories
```

### Technology Matrix
| Layer | Framework | Database | Mock Strategy | Execution Time |
|-------|-----------|----------|---------------|----------------|
| Unit | pytest + pytest-mock | SQLite in-memory | Aggressive (all I/O) | `< 5 min` |
| Integration | pytest + httpx | PostgreSQL 15 (testcontainers) | External APIs only | `< 15 min` |
| E2E | pytest + subprocess | Full docker-compose | None (real services) | `< 30 min` |
| Performance | Locust | Production replica (scaled down) | None | `15 min` |

---

## 3. Detailed Test Suite Structure

### Unit Tests (`tests/unit/`)

```python
# tests/unit/test_underwriting.py
class TestGDSCalculation:
    """GDS/TDS/LTV with Decimal precision enforcement"""
    
    @pytest.mark.parametrize("income,property_tax,heating,gds_ratio", [
        (Decimal("100000"), Decimal("4000"), Decimal("1200"), Decimal("0.321")),
        (Decimal("50000"), Decimal("2000"), Decimal("600"), Decimal("0.321")),
    ])
    def test_gds_standard_calculation(self, income, property_tax, heating, gds_ratio):
        # GDS = (PITH) / Gross Income
        # PITH = Principal + Interest + Taxes + Heating
        result = calculate_gds(income, property_tax, heating, interest_rate=Decimal("0.05"))
        assert result == gds_ratio
        assert isinstance(result, Decimal)
    
    def test_gds_ceiling_enforcement(self):
        """CMHC max GDS is 39%"""
        with pytest.raises(UnderwritingException) as exc:
            calculate_gds(
                income=Decimal("50000"),
                property_tax=Decimal("8000"),  # Exceeds 39%
                heating=Decimal("2000"),
                enforce_ceiling=True
            )
        assert "GDS exceeds 39% ceiling" in str(exc.value)

class TestStressTest:
    def test_stress_test_floor_validation(self):
        """OSFI Guideline B-20: minimum qualifying rate 5.25%"""
        rate = get_stress_test_rate(contract_rate=Decimal("0.03"))
        assert rate == Decimal("0.0525")  # Max of contract + 2% or 5.25%
        assert rate >= Decimal("0.0525")
```

```python
# tests/unit/test_fintrac.py
class TestCashThreshold:
    def test_structuring_detection(self):
        """Multiple deposits just under $10k threshold"""
        transactions = [Decimal("9500"), Decimal("9400"), Decimal("9600")]
        assert detect_structuring(transactions) is True
        
    def test_retention_calculation(self):
        """FINTRAC records kept 5 years from transaction date"""
        txn_date = date(2024, 1, 15)
        retention_date = calculate_retention_date(txn_date)
        assert retention_date == date(2029, 1, 15)
```

```python
# tests/unit/test_auth.py
class TestJWTLifecycle:
    def test_token_expiry(self, freezer):
        """Token expires exactly at TTL"""
        token = generate_jwt(user_id="broker_123", role="broker")
        freezer.move_to(datetime.utcnow() + timedelta(hours=1))
        with pytest.raises(JWTExpiredError):
            validate_jwt(token)
    
    def test_token_refresh_flow(self):
        """Refresh token rotation with old token invalidation"""
        old_token = generate_refresh_token("broker_123")
        new_token = refresh_token(old_token)
        assert validate_refresh_token(old_token) is False  # One-time use
        assert validate_refresh_token(new_token) is True
```

```python
# tests/unit/test_documents.py
class TestFileValidation:
    def test_mime_type_validation(self):
        """Magic number inspection, not just extension"""
        fake_pdf = b"%PDF-1.4 fake content"
        assert validate_mime_type(fake_pdf, "application/pdf") is True
        assert validate_mime_type(b"fake", "application/pdf") is False
    
    @pytest.mark.parametrize("size_mb,expected", [
        (9.9, True),
        (10.0, True),
        (10.1, False),
    ])
    def test_size_limit_enforcement(self, size_mb, expected):
        """Max 10MB per document"""
        result = validate_file_size(size_mb * 1024 * 1024)
        assert result == expected
```

### Integration Tests (`tests/integration/`)

```python
# tests/integration/test_application_flow.py
class TestFullPipeline:
    """Complete mortgage application workflow"""
    
    @pytest.fixture
    def authenticated_broker(self, test_client):
        """Real JWT, isolated DB transaction"""
        token = generate_test_jwt(role="broker", broker_id="b123")
        test_client.headers.update({"Authorization": f"Bearer {token}"})
        return test_client
    
    def test_cmhc_eligibility_by_ltv(self, authenticated_broker, db_session):
        """LTV > 80% requires CMHC insurance; > 95% ineligible"""
        # Create application with 85% LTV
        response = authenticated_broker.post("/applications", json={
            "property_value": 500_000,
            "down_payment": 75_000,  # 85% LTV
            "income": 100_000
        })
        assert response.status_code == 201
        app = db_session.query(Application).first()
        assert app.requires_cmhc is True
        assert app.eligible is True
        
        # Test 96% LTV (over CMHC limit)
        response = authenticated_broker.post("/applications", json={
            "property_value": 500_000,
            "down_payment": 20_000,  # 96% LTV
        })
        assert response.status_code == 422
        assert "LTV exceeds CMHC maximum" in response.json()["detail"]
    
    def test_property_price_cmhc_cap(self, authenticated_broker):
        """Properties $1.5M+ cannot have CMHC insurance"""
        response = authenticated_broker.post("/applications", json={
            "property_value": 1_600_000,  # Over cap
            "down_payment": 400_000,
        })
        assert response.json()["cmhc_eligible"] is False
```

```python
# tests/integration/test_broker_access.py
class TestBrokerIsolation:
    """Row-level security enforcement"""
    
    def test_cross_broker_access_denied(self, db_session):
        """Broker A cannot access Broker B's client data"""
        broker_a_token = generate_test_jwt(broker_id="broker_a")
        broker_b_client = create_test_client(broker_id="broker_b")
        
        response = test_client.get(
            f"/clients/{broker_b_client.id}",
            headers={"Authorization": f"Bearer {broker_a_token}"}
        )
        assert response.status_code == 403
        assert "access denied" in response.json()["detail"].lower()
    
    def test_client_data_isolation_query(self, db_session):
        """SQL WHERE clause injection test"""
        broker_a_token = generate_test_jwt(broker_id="broker_a")
        # Even with malicious query param, RLS should filter
        response = test_client.get(
            "/applications?where=broker_id='broker_b'",
            headers={"Authorization": f"Bearer {broker_a_token}"}
        )
        assert len(response.json()["applications"]) == 0
```

### E2E Tests (`tests/e2e/`)

```bash
# tests/e2e/test_workflows.sh
#!/bin/bash
set -e

# E2E Test with curl commands
API_URL="${API_URL:-http://localhost:8000}"
BROKER_TOKEN=$(curl -s -X POST "$API_URL/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username":"test_broker","password":"test"}' | jq -r .access_token)

# Test complete application flow
APPLICATION_ID=$(curl -s -X POST "$API_URL/applications" \
  -H "Authorization: Bearer $BROKER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "borrower": {"name": "John Doe", "sin": "encrypted_sin"},
    "property": {"value": 500000, "address": "123 Main St"},
    "income": 100000,
    "down_payment": 100000
  }' | jq -r .id)

# Upload document
curl -X POST "$API_URL/applications/$APPLICATION_ID/documents" \
  -H "Authorization: Bearer $BROKER_TOKEN" \
  -F "file=@test_document.pdf;type=application/pdf"

# Check underwriting decision
DECISION=$(curl -s "$API_URL/applications/$APPLICATION_ID/decision" \
  -H "Authorization: Bearer $BROKER_TOKEN")
echo "Decision: $DECISION"

# Verify audit trail
AUDIT_LOG=$(curl -s "$API_URL/audit/applications/$APPLICATION_ID" \
  -H "Authorization: Bearer $BROKER_TOKEN")
echo "Audit entries: $(echo $AUDIT_LOG | jq '.count')"
```

---

## 4. Fixture & Mocking Strategy

### Factory Pattern with `factoryboy`
```python
# tests/fixtures/factories.py
import factory
from decimal import Decimal
from models import Application, Client

class ClientFactory(factory.alchemy.SQLAlchemyModelFactory):
    class Meta:
        model = Client
    
    id = factory.Sequence(lambda n: f"client_{n}")
    sin = factory.LazyFunction(lambda: encrypt_sin("123-456-789"))
    broker_id = "broker_123"

class ApplicationFactory(factory.alchemy.SQLAlchemyModelFactory):
    class Meta:
        model = Application
    
    client = factory.SubFactory(ClientFactory)
    property_value = Decimal("500000")
    down_payment = Decimal("100000")
    income = Decimal("100000")
    
    @factory.lazy_attribute
    def ltv(self):
        return (self.property_value - self.down_payment) / self.property_value

# Pytest fixture
@pytest.fixture
def sample_application(db_session):
    """Rollback-isolated application"""
    app = ApplicationFactory()
    db_session.commit()
    yield app
    db_session.rollback()
```

### External Service Mocking
```python
# tests/fixtures/mocks.py
@pytest.fixture
def mock_credit_bureau(responses):
    """Mock Equifax/TransUnion API"""
    responses.add(
        responses.GET,
        "https://api.credit-bureau.ca/v1/score",
        json={"score": 750, "debt": 15000},
        status=200
    )
```

### Database Isolation
```python
# conftest.py
@pytest.fixture(scope="function")
def db_session():
    """Transaction-per-test isolation"""
    connection = engine.connect()
    transaction = connection.begin()
    session = Session(bind=connection)
    
    yield session
    
    session.close()
    transaction.rollback()
    connection.close()
```

---

## 5. Load & Performance Testing

### Locust Scenarios (`tests/performance/locustfile.py`)
```python
from locust import HttpUser, task, between
from decimal import Decimal

class MortgageApplicant(HttpUser):
    wait_time = between(1, 3)
    
    def on_start(self):
        self.token = self.login()
    
    def login(self):
        response = self.client.post("/auth/login", json={
            "username": "load_test_broker",
            "password": "test"
        })
        return response.json()["access_token"]
    
    @task(3)
    def submit_application(self):
        """Peak load: 100 applications/hour = ~0.028 req/s per user"""
        self.client.post("/applications", 
            headers={"Authorization": f"Bearer {self.token}"},
            json={
                "property_value": 500000,
                "down_payment": 100000,
                "income": 100000
            }
        )
    
    @task(1)
    def get_decision(self):
        self.client.get("/applications/12345/decision",
            headers={"Authorization": f"Bearer {self.token}"}
        )
```

### Performance Baselines (`tests/performance/test_baselines.py`)
```python
# pytest-benchmark
def test_gds_calculation_performance(benchmark):
    """GDS must calculate in < 10ms for 1000 iterations"""
    result = benchmark(calculate_gds, 
        income=Decimal("100000"),
        property_tax=Decimal("4000"),
        heating=Decimal("1200")
    )
    assert result < 0.01  # seconds
```

**Load Targets**:
- **Sustained**: 50 concurrent applications/hour
- **Peak**: 200 applications/hour (tax season, rate drops)
- **p95 Latency**: < 500ms for underwriting decision
- **p99 Latency**: < 2s for document processing

---

## 6. CI/CD Pipeline Integration

### GitHub Actions Workflow (`.github/workflows/test.yml`)
```yaml
name: Mortgage System Tests

on: [push, pull_request]

jobs:
  unit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: {python-version: "3.11.8"}
      - run: pip install -r requirements-dev.txt
      - run: pytest tests/unit --cov=src --cov-fail-under=80
      - uses: codecov/codecov-action@v3

  integration:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:15.2
        env: {POSTGRES_PASSWORD: test}
        ports: ["5432:5432"]
        options: --health-cmd="pg_isready"
    steps:
      - uses: actions/checkout@v4
      - run: pytest tests/integration --cov=src --cov-append
      - run: pytest tests/integration/test_auth_flow.py --mTLS-cert=/tmp/test-cert.pem

  e2e:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: docker-compose -f docker-compose.test.yml up -d
      - run: ./tests/e2e/test_workflows.sh
      - run: docker-compose -f docker-compose.test.yml down

  performance:
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: locust -f tests/performance/locustfile.py --headless -u 50 -r 10 --run-time=15m
      - run: pytest tests/performance/test_baselines.py --benchmark-json=output.json

  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: bandit -r src/
      - run: safety check
      - run: pytest tests/security/test_mtls.py
```

### Pre-commit Hooks (`.pre-commit-config.yaml`)
```yaml
repos:
  - repo: local
    hooks:
      - id: pytest-unit
        name: Run unit tests
        entry: pytest tests/unit -x
        language: system
        pass_filenames: false
        stages: [pre-push]
```

---

## 7. Security & Compliance Testing

### mTLS Test (`tests/security/test_mtls.py`)
```python
def test_mutual_tls_enforcement():
    """Only clients with valid certificates can access FINTRAC endpoints"""
    client_cert = ("/tmp/test-client.crt", "/tmp/test-client.key")
    response = requests.post(
        "https://api.mortgage.internal/fintrac/report",
        cert=client_cert,
        json={"transaction_id": "txn_123"}
    )
    assert response.status_code == 200
    
    # No cert = immediate rejection
    with pytest.raises(SSLError):
        requests.post(
            "https://api.mortgage.internal/fintrac/report",
            json={"transaction_id": "txn_123"}
        )
```

### Audit Log Verification (`tests/integration/test_audit.py`)
```python
def test_fintrac_audit_trail(db_session):
    """Every FINTRAC check is logged for 5-year retention"""
    old_count = db_session.query(AuditLog).count()
    check_fintrac_eligibility(client_id="client_123")
    
    new_logs = db_session.query(AuditLog).filter(
        AuditLog.action == "fintrac_check"
    ).all()
    assert len(new_logs) == 1
    assert new_logs[0].retention_date == date.today() + timedelta(days=1825)
```

---

## 8. Accessibility (a11y) Testing

### TypeScript Frontend Tests (`frontend/tests/a11y/`)

```typescript
// tests/a11y/mortgage-form.test.ts
import { test, expect } from '@playwright/test';
import AxeBuilder from '@axe-core/playwright';

test('mortgage application form meets WCAG 2.1 AA', async ({ page }) => {
  await page.goto('/applications/new');
  
  const accessibilityScanResults = await new AxeBuilder({ page })
    .withTags(['wcag2a', 'wcag2aa', 'wcag21aa'])
    .exclude('.third-party-widget')
    .analyze();
  
  expect(accessibilityScanResults.violations).toEqual([]);
});
```

**CI Integration**:
```yaml
- name: Run a11y tests
  run: |
    cd frontend
    npx playwright test tests/a11y
```

---

## 9. Test Data Management & Cleanup

### Database Seeding (`tests/fixtures/seed.py`)
```python
# Minimal seed data for CI
def seed_cmhc_rules(db_session):
    """CMHC eligibility rules as code"""
    db_session.add_all([
        CMHC_Rule(max_ltv=Decimal("0.80"), requires_insurance=False),
        CMHC_Rule(max_ltv=Decimal("0.95"), requires_insurance=True, max_property_value=1_500_000),
    ])
    db_session.commit()

def cleanup_test_data(db_session):
    """Post-test anonymization for non-production"""
    db_session.execute(
        update(Client).where(Client.is_test_data == True)
        .values(sin=encrypt_sin("000-000-000"))
    )
```

### Docker Compose for Testing (`docker-compose.test.yml`)
```yaml
services:
  postgres-test:
    image: postgres:15.2
    environment:
      POSTGRES_DB: mortgage_test
      POSTGRES_PASSWORD: test
    tmpfs: /var/lib/postgresql/data  # RAM-only for speed
    ports: ["5432:5432"]
  
  redis-mock:
    image: redis:7-alpine
    command: redis-server --save "" --appendonly no  # No persistence
  
  app:
    build: .
    environment:
      DATABASE_URL: postgresql://postgres:test@postgres-test:5432/mortgage_test
      TESTING: "true"
    depends_on: [postgres-test, redis-mock]
```

---

## 10. Quality Gates & Reporting

### Coverage Configuration (`pyproject.toml`)
```toml
[tool.coverage.run]
source = ["src"]
omit = ["*/migrations/*", "*/tests/*"]
precision = 2

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "raise NotImplementedError",
    "if TYPE_CHECKING:",
]
fail_under = 80

[tool.coverage.html]
directory = "coverage_html"
title = "Mortgage System Coverage"
```

### Test Result Annotation (`tests/conftest.py`)
```python
def pytest_sessionfinish(session, exitstatus):
    """Generate GitHub Actions annotations for failed tests"""
    if os.getenv("GITHUB_ACTIONS"):
        for item in session.items:
            if item.nodeid in session.testsfailed:
                print(f"::error file={item.location[0]},line={item.location[1]}::{item.nodeid}")
```

---

## 11. Implementation Roadmap

### Phase 1: Foundation (Week 1-2)
- [ ] Set up pytest + testcontainers + factoryboy
- [ ] Create `ClientFactory`, `ApplicationFactory`
- [ ] Implement unit tests for `test_underwriting.py` (GDS/TDS/LTV)
- [ ] Configure 80% coverage gate in CI

### Phase 2: Integration & Security (Week 3-4)
- [ ] Build `authenticated_broker` fixture with JWT
- [ ] Complete `test_application_flow.py` (CMHC rules)
- [ ] Implement mTLS tests for FINTRAC endpoints
- [ ] Add audit log verification tests

### Phase 3: E2E & Performance (Week 5-6)
- [ ] Write `test_workflows.sh` with curl commands
- [ ] Deploy Locust cluster for load testing
- [ ] Establish performance baselines (p95 < 500ms)
- [ ] Run first full pipeline in CI

### Phase 4: Compliance & Polish (Week 7)
- [ ] FINTRAC retention rule automation tests
- [ ] SIN encryption/decryption integration test
- [ ] Add a11y tests for frontend
- [ ] Generate compliance report for auditors

---

## 12. Recommended Stack Additions

```json
{
  "testing_tools": {
    "unit": "pytest 8.0+, pytest-mock 3.12+, pytest-cov 4.1+",
    "integration": "httpx 0.26+, testcontainers-python 3.7+",
    "fixtures": "factoryboy 3.3+, faker 22.0+",
    "performance": "locust 2.20+, pytest-benchmark 4.0+",
    "security": "bandit 1.7+, safety 3.0+, responses 0.24+",
    "e2e": "bashate 2.1+, jq 1.7+",
    "a11y": "@axe-core/playwright 4.8+, playwright 1.40+"
  },
  "ci_cd": "GitHub Actions with 4 parallel jobs",
  "reporting": "Codecov for coverage, Allure for test reports"
}
```

This architecture ensures **financial calculation accuracy**, **regulatory compliance automation**, and **production-grade security validation** while maintaining developer velocity through fast, isolated tests.