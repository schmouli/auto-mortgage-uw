```python
import pytest
from fastapi.testclient import TestClient
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker, Session
from typing import Dict, Any

# Assuming the project structure uses SQLAlchemy and FastAPI
# Adjust imports based on actual project layout
from sqlalchemy.ext.declarative import declarative_base

Base = declarative_base()

# Database Setup for Integration Tests
SQLALCHEMY_DATABASE_URL = "sqlite:///:memory:"
engine = create_engine(SQLALCHEMY_DATABASE_URL, connect_args={"check_same_thread": False})
TestingSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# Mock Models for testing context (Simplified for the fixture)
class MortgageApplication(Base):
    __tablename__ = "applications"
    id = int
    applicant_name = str
    income = float
    credit_score = int
    loan_amount = float
    status = str

@pytest.fixture(scope="function")
def db_session():
    """
    Creates a fresh database session for each test.
    """
    Base.metadata.create_all(bind=engine)
    session = TestingSessionLocal()
    try:
        yield session
    finally:
        session.rollback()
        session.close()
        Base.metadata.drop_all(bind=engine)

@pytest.fixture(scope="function")
def client(db_session: Session):
    """
    Creates a FastAPI TestClient with a database session override.
    """
    from main import app, get_db  # Assumed entry point

    def override_get_db():
        try:
            yield db_session
        finally:
            pass

    app.dependency_overrides[get_db] = override_get_db
    with TestClient(app) as test_client:
        yield test_client
    app.dependency_overrides.clear()

@pytest.fixture
def valid_applicant_data() -> Dict[str, Any]:
    """
    Standard payload for a successful mortgage application.
    """
    return {
        "applicant_name": "John Doe",
        "income": 85000.00,
        "credit_score": 780,
        "loan_amount": 350000.00,
        "property_value": 450000.00,
        "property_tax": 3000.00,
        "heating_cost": 1200.00,
        "other_debt": 450.00
    }

@pytest.fixture
def high_risk_applicant_data() -> Dict[str, Any]:
    """
    Payload for an applicant likely to be rejected (High TDS, Low Credit).
    """
    return {
        "applicant_name": "Jane Risk",
        "income": 45000.00,
        "credit_score": 580,
        "loan_amount": 300000.00,
        "property_value": 310000.00,
        "property_tax": 4000.00,
        "heating_cost": 1500.00,
        "other_debt": 1200.00
    }

@pytest.fixture
def mock_credit_bureau_response(monkeypatch):
    """
    Mocks the external credit bureau API call.
    """
    def mock_get_score(*args, **kwargs):
        return {"score": 750, "status": "excellent"}
    
    # Assuming 'requests' or an internal client is used
    import sys
    sys.modules['external_credit_service'] = pytest.Mock()
    sys.modules['external_credit_service'].get_credit_score = mock_get_score
```